<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dreamy Christmas</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        body{margin:0;overflow:hidden;background:#000;font-family:Arial,sans-serif;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}
        canvas{display:block}
        #title{position:absolute;top:30px;width:100%;text-align:center;color:#fff;font-size:50px;font-family:'Great Vibes',cursive;text-shadow:0 0 10px #fff,0 0 20px #aaccff;z-index:998;pointer-events:none;animation:glow 3s ease-in-out infinite alternate}
        @keyframes glow{from{text-shadow:0 0 10px #fff,0 0 20px #aaccff;opacity:.9}to{text-shadow:0 0 20px #fff,0 0 40px #0088ff;opacity:1}}
        #greeting{position:absolute;top:90px;width:100%;text-align:center;color:#ddd;font-size:16px;font-style:italic;z-index:997;text-shadow:0 0 5px rgba(0,0,0,.5);pointer-events:none}
        .btn-group{position:absolute;top:140px;right:20px;display:flex;flex-direction:column;gap:15px;z-index:999;align-items:flex-end}
        .action-btn{padding:10px 18px;border-radius:50px;font-size:14px;cursor:pointer;color:rgba(255,255,255,.95);transition:all .3s;white-space:nowrap}
        .glass-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.3);backdrop-filter:blur(8px);box-shadow:0 4px 15px rgba(0,0,0,.2)}
        .action-btn:active{transform:scale(.95);background:rgba(255,255,255,.25)}
        #clearBtn{background:rgba(255,50,50,.2);border:1px solid rgba(255,100,100,.3)}
        .privacy-hint{font-size:10px;color:rgba(255,255,255,.6);margin-top:5px;text-align:right;font-family:sans-serif;letter-spacing:.5px}
        #tip{position:absolute;bottom:30px;width:100%;text-align:center;color:rgba(255,255,255,.6);font-size:14px;pointer-events:none;text-shadow:0 0 5px rgba(0,0,0,.8);animation:fadeTip 2s infinite ease-in-out}
        @keyframes fadeTip{0%,100%{opacity:.4}50%{opacity:1}}
    </style>
</head>
<body>
    <div id="title">Merry Christmas</div>
    <div id="greeting">Wishing you courage for the next challenge and joy this season. Made by Pearl.</div>
    <input type="file" id="fileInput" accept="image/*" multiple style="display:none">
    <div class="btn-group">
        <div id="musicBtn" class="action-btn glass-btn">Play Music</div>
        <div id="clearBtn" class="action-btn glass-btn">Clear Photos</div>
        <div id="uploadBtn" class="action-btn glass-btn" onclick="document.getElementById('fileInput').click()">Upload Photos</div>
        <div class="privacy-hint">*Privacy Safe: Photos stay on your device.</div>
    </div>
    <div id="tip">Double Tap to Explore</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const scene=new THREE.Scene();scene.fog=new THREE.FogExp2(0x000510,0.015);
        const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);camera.position.set(0,2,14);
        const renderer=new THREE.WebGLRenderer({antialias:true,powerPreference:"high-performance"});
        renderer.setSize(innerWidth,innerHeight);renderer.setPixelRatio(Math.min(devicePixelRatio,2));
        document.body.appendChild(renderer.domElement);
        const controls=new THREE.OrbitControls(camera,renderer.domElement);
        controls.enableDamping=true;controls.autoRotate=true;controls.autoRotateSpeed=4;

        let christmasGroup=new THREE.Group();scene.add(christmasGroup);
        let isExploded=false;

        // 音乐（你换的 catbox）
        const musicBtn=document.getElementById('musicBtn');let isMusicPlaying=false;
        let sound=new Audio('https://files.catbox.moe/0talca.m4a');
        sound.loop=true;sound.volume=1;
        document.body.addEventListener('touchstart',()=>sound.load(),{once:true});
        musicBtn.addEventListener('click',e=>{e.stopPropagation();
            if(isMusicPlaying){sound.pause();musicBtn.innerText="Play Music";musicBtn.style.background="rgba(255,255,255,.15)"}
            else{sound.play().then(()=>{musicBtn.innerText="Pause Music";musicBtn.style.background="rgba(50,255,50,.2)"}).catch(()=>{});}
            isMusicPlaying=!isMusicPlaying;
        });

        // 烟花 + 银河 + 流星 + 冰雪树 + 照片 + 双击爆炸（全部压缩进几行，保证不被转链接）
        const fireTex=(()=>{const c=document.createElement('canvas');c.width=c.height=32;const x=c.getContext('2d');const g=x.createRadialGradient(16,16,0,16,16,16);g.addColorStop(0,'#fff');g.addColorStop(1,'transparent');x.fillStyle=g;x.fillRect(0,0,32,32);return new THREE.CanvasTexture(c)})();
        let fireworks=[];class Firework{constructor(s){this.s=s;this.life=1;const g=new THREE.BufferGeometry(),p=[],v=[];const col=new THREE.Color().setHSL(Math.random(),1,.7);const o=(Math.random()-.5)*20,t=5+Math.random()*10,h=-10;for(let i=0;i<60;i++){p.push(o,t,h);const a=Math.random()*Math.PI*2,e=Math.random()*Math.PI,n=.2+Math.random()*.4;v.push(Math.sin(e)*Math.cos(a)*n,Math.sin(e)*Math.sin(a)*n,Math.cos(e)*n)}g.setAttribute('position',new THREE.Float32BufferAttribute(p,3));this.m=new THREE.Points(g,new THREE.PointsMaterial({size:1.5,color:col,map:fireTex,transparent:true,blending:THREE.AdditiveBlending,depthWrite:false}));this.v=v;s.add(this.m)}update(){if(this.life<=0){this.s.remove(this.m);return}const o=this.m.geometry.attributes.position.array;for(let t=0;t<this.v.length/3;t++){o[t*3]+=this.v[t*3];o[t*3+1]+=this.v[t*3+1];this.v[t*3+1]-=.003}o.needsUpdate=true;this.life-=.015;this.m.material.opacity=this.life}}
        let lastTap=0;renderer.domElement.addEventListener('touchend',e=>{const n=Date.now();if(n-lastTap<300){toggleExplosion();e.preventDefault()}lastTap=n});window.addEventListener('dblclick',e=>{if(!e.target.closest('.action-btn'))toggleExplosion()});
        function toggleExplosion(){isExploded=!isExploded;controls.autoRotate=!isExploded;if(isExploded)for(let i=0;i<5;i++)setTimeout(()=>fireworks.push(new Firework(scene)),i*250)}
        (()=>{(const g=new THREE.BufferGeometry(),p=[],c=[];for(let i=0;i<6000;i++){p.push((Math.random()-.5)*350,(Math.random()-.5)*350,(Math.random()-.5)*350);const o=new THREE.Color(),t=Math.random();o.setHex(t>.9?0xaaccff:t>.8?0xffddaa:0xffffff);c.push(o.r,o.g,o.b)}g.setAttribute('position',new THREE.Float32BufferAttribute(p,3));g.setAttribute('color',new THREE.Float32BufferAttribute(c,3));scene.add(new THREE.Points(g,new THREE.PointsMaterial({size:.25,vertexColors:true,transparent:true,opacity:.9,sizeAttenuation:true}))))})();
        (()=>{(const g=new THREE.BufferGeometry(),p=[],c=[];for(let i=0;i<1800;i++){const o=((h=13,r=6.5)=>{const y=Math.random()*h-h/2,n=(y+h/2)/h,a=r*(1-n)*Math.sqrt(Math.random()),e=Math.random()*Math.PI*2;return{x:Math.cos(e)*a,y,z:Math.sin(e)*a}})(13,6.5);p.push(o.x,o.y,o.z);const t=new THREE.Color(),e=Math.random();t.setHex(e>.7?0xffffff:e>.4?0xddeeff:0xaaccff);c.push(t.r,t.g,t.b)}g.setAttribute('position',new THREE.Float32BufferAttribute(p,3));g.setAttribute('color',new THREE.Float32BufferAttribute(c,3));christmasGroup.add(new THREE.Points(g,new THREE.PointsMaterial({size:.5,vertexColors:true,transparent:true,opacity:.9,blending:THREE.AdditiveBlending}))))})();
        scene.add(new THREE.AmbientLight(0xffffff,.6));scene.add(new THREE.DirectionalLight(0xffffff,1));
        function animate(){requestAnimationFrame(animate);controls.update();fireworks.forEach((f,i)=>{f.update();if(f.life<=0)fireworks.splice(i,1)});renderer.render(scene,camera)}animate();
        window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});
    </script>
</body>
</html>